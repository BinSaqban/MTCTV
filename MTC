//@version=5
indicator("Momentum Trend Confirmation (MTC)", shorttitle="MTC", overlay=true)

// --- INPUTS ---
// Trend Settings
trend_ema_len = input.int(200, title="Trend EMA Length", group="Trend Settings")
trend_ema_color = input.color(color.new(color.blue, 50), title="Trend EMA Color", group="Trend Settings")

// Momentum Settings (EMA Crossover)
fast_ema_len = input.int(20, title="Fast EMA Length", group="Momentum Settings")
slow_ema_len = input.int(50, title="Slow EMA Length", group="Momentum Settings")
fast_ema_color = input.color(color.new(color.green, 0), title="Fast EMA Color", group="Momentum Settings")
slow_ema_color = input.color(color.new(color.red, 0), title="Slow EMA Color", group="Momentum Settings")

// RSI Settings
rsi_len = input.int(14, title="RSI Length", group="RSI Settings")
rsi_midline = input.int(50, title="RSI Midline for Confirmation", group="RSI Settings")

// Volume Settings
vol_ma_len = input.int(20, title="Volume MA Length", group="Volume Settings")
vol_multiplier = input.float(1.5, title="Volume Multiplier for Spike", step=0.1, group="Volume Settings")

// --- CALCULATIONS ---
// Trend EMA
emaTrend = ta.ema(close, trend_ema_len)

// Momentum EMAs
emaFast = ta.ema(close, fast_ema_len)
emaSlow = ta.ema(close, slow_ema_len)

// RSI
rsi = ta.rsi(close, rsi_len)

// Volume MA
vol_ma = ta.sma(volume, vol_ma_len)

// --- CONDITIONS ---
// 1. Trend Condition
isUptrend = close > emaTrend
isDowntrend = close < emaTrend

// 2. Momentum Condition
bullishMomentum = rsi > rsi_midline
bearishMomentum = rsi < rsi_midline

// 3. Volume Condition
highVolume = volume > vol_ma * vol_multiplier

// 4. Crossover Trigger
bullCross = ta.crossover(emaFast, emaSlow)
bearCross = ta.crossunder(emaFast, emaSlow)

// --- FINAL SIGNALS ---
// Combine all conditions for a high-probability signal
buySignal = isUptrend and bullishMomentum and highVolume and bullCross
sellSignal = isDowntrend and bearishMomentum and highVolume and bearCross

// --- PLOTTING ---
// Plot EMAs on the chart
plot(emaTrend, color=trend_ema_color, linewidth=2, title="Trend EMA")
plot(emaFast, color=fast_ema_color, linewidth=1, title="Fast EMA")
plot(emaSlow, color=slow_ema_color, linewidth=1, title="Slow EMA")

// Plot Buy/Sell Signals
plotshape(buySignal, title="Buy Signal", text="BUY", textcolor=color.white, style=shape.labelup, location=location.belowbar, color=color.new(color.green, 20), size=size.small)
plotshape(sellSignal, title="Sell Signal", text="SELL", textcolor=color.white, style=shape.labeldown, location=location.abovebar, color=color.new(color.red, 20), size=size.small)

// Highlight the trend background
bgcolor(isUptrend ? color.new(color.green, 95) : isDowntrend ? color.new(color.red, 95) : na, title="Trend Background")

// --- ALERTS ---
// Create alert conditions for users to set up in TradingView
alertcondition(buySignal, title="MTC Buy Alert", message="Momentum Trend Confirmation: BUY signal on {{ticker}}")
alertcondition(sellSignal, title="MTC Sell Alert", message="Momentum Trend Confirmation: SELL signal on {{ticker}}")
